<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¿ãƒ¬ãƒ³ãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆæ¥­ç•Œ å¤‰åŒ–è¿½è·¡ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8fafc;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 30px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 600;
            color: #1e293b;
            text-align: center;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .company-select {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            min-width: 200px;
        }
        
        .company-select:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .update-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        .update-btn:hover {
            background: #2563eb;
        }
        
        .update-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            border: 1px solid #e2e8f0;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #3b82f6;
            display: block;
        }
        
        .stat-label {
            color: #64748b;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .section {
            background: white;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }
        
        .section h2 {
            font-size: 20px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .comparison-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .comparison-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            position: relative;
        }
        
        .comparison-card.current {
            border-color: #10b981;
        }
        
        .comparison-card.previous {
            border-color: #f59e0b;
        }
        
        .comparison-header {
            font-weight: 600;
            margin-bottom: 15px;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .comparison-header.current {
            background: #dcfce7;
            color: #166534;
        }
        
        .comparison-header.previous {
            background: #fef3c7;
            color: #92400e;
        }
        
        .comparison-content {
            space-y: 15px;
        }
        
        .comparison-item {
            margin-bottom: 15px;
        }
        
        .comparison-label {
            font-weight: 600;
            color: #64748b;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .comparison-text {
            background: #f8fafc;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #e2e8f0;
            word-break: break-word;
            min-height: 60px;
        }
        
        .companies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        
        .company-card {
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafafa;
        }
        
        .company-card:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
            transform: translateY(-2px);
        }
        
        .company-card.active {
            border-color: #3b82f6;
            background: #eff6ff;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        
        .company-name {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 10px;
        }
        
        .company-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .change-count {
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .change-count.active {
            background: #dcfce7;
            color: #166534;
        }
        
        .change-count.inactive {
            background: #f1f5f9;
            color: #64748b;
        }
        
        .changes-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .change-item {
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            margin-bottom: 15px;
            background: #fafafa;
            border-left: 4px solid #3b82f6;
        }
        
        .change-header {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 10px;
        }
        
        .change-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            font-size: 14px;
        }
        
        .change-before,
        .change-after {
            padding: 10px;
            border-radius: 4px;
            background: white;
            border: 1px solid #e2e8f0;
        }
        
        .change-label {
            font-weight: 600;
            color: #64748b;
            margin-bottom: 5px;
            font-size: 12px;
            text-transform: uppercase;
        }
        
        .change-text {
            color: #374151;
            word-break: break-word;
        }
        
        .change-date {
            color: #64748b;
            font-size: 12px;
            text-align: right;
            margin-top: 10px;
        }
        
        .error-message {
            background: #fef2f2;
            color: #dc2626;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #fecaca;
            margin-bottom: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }
        
        .loading::before {
            content: "â³";
            font-size: 24px;
            display: block;
            margin-bottom: 10px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }
        
        .empty-state::before {
            content: "ğŸ“­";
            font-size: 48px;
            display: block;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .change-details,
            .comparison-view {
                grid-template-columns: 1fr;
            }
            
            .companies-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .company-select {
                min-width: 100%;
            }
        }
        
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
            background: #f8fafc;
            border-radius: 8px;
            border: 2px dashed #cbd5e1;
        }
        
        .no-data h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .no-data p {
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>ğŸš€ ã‚¿ãƒ¬ãƒ³ãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆæ¥­ç•Œ å¤‰åŒ–è¿½è·¡ã‚·ã‚¹ãƒ†ãƒ </h1>
        </div>
    </div>

    <div class="container">
        <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
        <div class="controls">
            <select id="companySelect" class="company-select">
                <option value="">ğŸ“Š ã™ã¹ã¦ã®ä¼æ¥­ã‚’è¡¨ç¤º</option>
            </select>
            <button id="updateBtn" class="update-btn" onclick="loadData()">
                ğŸ”„ ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
            </button>
        </div>
        
        <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
        <div id="errorContainer"></div>
        
        <!-- çµ±è¨ˆæƒ…å ± -->
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-number" id="totalCompanies">-</span>
                <div class="stat-label">ç›£è¦–å¯¾è±¡ä¼æ¥­</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="totalChanges">-</span>
                <div class="stat-label">ç·å¤‰æ›´æ•°</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="activeCompanies">-</span>
                <div class="stat-label">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ä¼æ¥­</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="lastUpdate">-</span>
                <div class="stat-label">æœ€çµ‚æ›´æ–°</div>
            </div>
        </div>

        <!-- æ¯”è¼ƒè¡¨ç¤º -->
        <div id="comparisonSection" class="section" style="display: none;">
            <h2 id="comparisonTitle">ğŸ” ã‚µã‚¤ãƒˆè¦‹ãˆæ–¹æ¯”è¼ƒ</h2>
            <div id="comparisonContent"></div>
        </div>

        <!-- ä¼æ¥­ä¸€è¦§ -->
        <div class="section" id="companiesSection">
            <h2>ğŸ“Š ç›£è¦–å¯¾è±¡ä¼æ¥­</h2>
            <div id="companiesContainer">
                <div class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>
            </div>
        </div>

        <!-- å¤‰æ›´å±¥æ­´ -->
        <div class="section">
            <h2 id="changesTitle">ğŸ“‹ æœ€æ–°å¤‰æ›´å±¥æ­´</h2>
            <div id="changesContainer">
                <div class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>
            </div>
        </div>
    </div>

    <!-- ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ -->
    <script src="sample-data.js"></script>

    <script>
        let companies = [];
        let changes = [];
        let selectedCompany = null;

        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        async function loadData() {
            const updateBtn = document.getElementById('updateBtn');
            updateBtn.textContent = 'â³ èª­ã¿è¾¼ã¿ä¸­...';
            updateBtn.disabled = true;
            
            clearError();
            
            try {
                // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼ˆJSONãƒ•ã‚¡ã‚¤ãƒ«ã®ä»£æ›¿ï¼‰
                companies = sampleCompanies;
                changes = sampleChanges;
                
                updateStats();
                renderCompanies();
                renderChanges();
                populateCompanySelect();
                
                updateBtn.textContent = 'âœ… æ›´æ–°å®Œäº†';
                setTimeout(() => {
                    updateBtn.textContent = 'ğŸ”„ ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°';
                    updateBtn.disabled = false;
                }, 2000);
                
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                showError(`ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
                updateBtn.textContent = 'âŒ æ›´æ–°å¤±æ•—';
                updateBtn.disabled = false;
            }
        }

        // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã«ä¼æ¥­ãƒªã‚¹ãƒˆã‚’è¿½åŠ 
        function populateCompanySelect() {
            const select = document.getElementById('companySelect');
            
            // æ—¢å­˜ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢ï¼ˆæœ€åˆã®ã‚‚ã®ã¯æ®‹ã™ï¼‰
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            // ä¼æ¥­ã‚’è¿½åŠ 
            companies.forEach(company => {
                const option = document.createElement('option');
                option.value = company.id;
                option.textContent = `ğŸ¢ ${company.name}`;
                select.appendChild(option);
            });
            
            // å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            select.onchange = function() {
                const companyId = parseInt(this.value);
                if (companyId) {
                    selectCompanyById(companyId);
                } else {
                    resetSelection();
                }
            };
        }

        // IDã§ä¼æ¥­é¸æŠ
        function selectCompanyById(companyId) {
            selectedCompany = companies.find(c => c.id === companyId);
            if (selectedCompany) {
                renderCompanies();
                renderChanges();
                renderComparison();
                document.getElementById('changesTitle').textContent = `ğŸ“‹ ${selectedCompany.name} ã®å¤‰æ›´å±¥æ­´`;
            }
        }

        // çµ±è¨ˆæƒ…å ±æ›´æ–°
        function updateStats() {
            document.getElementById('totalCompanies').textContent = companies.length;
            document.getElementById('totalChanges').textContent = changes.length;
            
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ä¼æ¥­æ•°ï¼ˆå¤‰æ›´ãŒã‚ã£ãŸä¼æ¥­ï¼‰
            const activeCompanies = companies.filter(company => company.change_count > 0).length;
            document.getElementById('activeCompanies').textContent = activeCompanies;
            
            // æœ€çµ‚æ›´æ–°æ™‚åˆ»
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString('ja-JP', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // ä¼æ¥­ä¸€è¦§æç”»
        function renderCompanies() {
            const container = document.getElementById('companiesContainer');
            
            if (companies.length === 0) {
                container.innerHTML = '<div class="empty-state">ä¼æ¥­ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            container.innerHTML = `
                <div class="companies-grid">
                    ${companies.map(company => `
                        <div class="company-card ${selectedCompany?.id === company.id ? 'active' : ''}" 
                             onclick="selectCompany(${company.id})">
                            <div class="company-name">${escapeHtml(company.name)}</div>
                            <div class="company-stats">
                                <span class="change-count ${company.change_count > 0 ? 'active' : 'inactive'}">
                                    å¤‰æ›´: ${company.change_count}å›
                                </span>
                                <div style="font-size: 12px; color: #64748b;">
                                    ${company.last_checked ? formatDateTime(company.last_checked) : 'æœªç¢ºèª'}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ä¼æ¥­é¸æŠ
        function selectCompany(companyId) {
            selectedCompany = companies.find(c => c.id === companyId);
            const select = document.getElementById('companySelect');
            select.value = companyId;
            
            renderCompanies();
            renderChanges();
            renderComparison();
            
            document.getElementById('changesTitle').textContent = `ğŸ“‹ ${selectedCompany.name} ã®å¤‰æ›´å±¥æ­´`;
        }

        // é¸æŠãƒªã‚»ãƒƒãƒˆ
        function resetSelection() {
            selectedCompany = null;
            const select = document.getElementById('companySelect');
            select.value = '';
            
            renderCompanies();
            renderChanges();
            hideComparison();
            
            document.getElementById('changesTitle').textContent = 'ğŸ“‹ æœ€æ–°å¤‰æ›´å±¥æ­´';
        }

        // æ¯”è¼ƒè¡¨ç¤º
        function renderComparison() {
            if (!selectedCompany) {
                hideComparison();
                return;
            }

            const section = document.getElementById('comparisonSection');
            const content = document.getElementById('comparisonContent');
            const title = document.getElementById('comparisonTitle');

            // å°‚é–€ç”¨èªã‚¬ã‚¤ãƒ‰ã®å ´åˆ
            if (selectedCompany.isGuide) {
                title.textContent = `ğŸ“– å°‚é–€ç”¨èªã‚¬ã‚¤ãƒ‰`;
                content.innerHTML = `
                    <div style="text-align: center; padding: 20px; background: #f8fafc; border-radius: 8px;">
                        <h3 style="margin-bottom: 15px; color: #1e293b;">ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã§ä½¿ç”¨ã™ã‚‹å°‚é–€ç”¨èªã®èª¬æ˜</h3>
                        <img src="${selectedCompany.guideImage}" alt="å°‚é–€ç”¨èªã‚¬ã‚¤ãƒ‰" style="max-width: 100%; height: auto; border: 2px solid #e2e8f0; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    </div>
                `;
                section.style.display = 'block';
                return;
            }

            title.textContent = `ğŸ” ${selectedCompany.name} ã®ã‚µã‚¤ãƒˆè¦‹ãˆæ–¹æ¯”è¼ƒ`;

            // å¤‰æ›´ç®‡æ‰€ã®ãƒãƒƒã‚¸ç”Ÿæˆ
            const changesHtml = selectedCompany.changes ? selectedCompany.changes.map(change => {
                const badgeColor = change.type === 'HP' ? '#10b981' :
                                 change.type === 'SEO' ? '#f59e0b' :
                                 change.type === 'AD' ? '#8b5cf6' : '#6b7280';
                const badgeIcon = change.type === 'HP' ? 'ğŸ ' :
                                change.type === 'SEO' ? 'ğŸ”' :
                                change.type === 'AD' ? 'ğŸ“º' : 'ğŸ“';

                return `
                    <span class="change-badge" style="background: ${badgeColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 6px; display: inline-block; margin-bottom: 4px;">
                        ${badgeIcon} ${change.category}
                    </span>
                `;
            }).join('') : '';

            content.innerHTML = `
                <!-- ã‚µã‚¤ãƒˆURL -->
                <div style="margin-bottom: 20px; text-align: center;">
                    <a href="${selectedCompany.url}" target="_blank" class="site-link" style="
                        display: inline-block;
                        background: #3b82f6;
                        color: white;
                        text-decoration: none;
                        padding: 10px 20px;
                        border-radius: 6px;
                        font-weight: 600;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.background='#2563eb'" onmouseout="this.style.background='#3b82f6'">
                        ğŸŒ ${selectedCompany.name} ã®ã‚µã‚¤ãƒˆã‚’è¦‹ã‚‹
                    </a>
                </div>
                
                <!-- å¤‰æ›´ã‚«ãƒ†ã‚´ãƒª -->
                ${changesHtml ? `
                    <div style="margin-bottom: 20px; padding: 15px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <h4 style="margin-bottom: 10px; color: #1e293b; font-weight: 600;">ğŸ“Š å¤‰æ›´ã‚«ãƒ†ã‚´ãƒª</h4>
                        ${changesHtml}
                    </div>
                ` : ''}
                
                <!-- å…·ä½“çš„ãªå¤‰æ›´ç®‡æ‰€ -->
                ${selectedCompany.screenshots?.highlights ? `
                    <div style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px; color: #1e293b; font-weight: 600;">ğŸ” å…·ä½“çš„ãªå¤‰æ›´ç®‡æ‰€</h3>
                        <div style="padding: 15px; background: #f0f9ff; border-radius: 8px; border: 1px solid #bfdbfe;">
                            ${selectedCompany.screenshots.highlights.map((highlight, index) => {
                                // ã‚¸ãƒ£ãƒ³ãƒ«ã”ã¨ã®è‰²ã‚’å–å¾—(highlight.genreãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§HPã®è‰²)
                                const genre = highlight.genre || 'HP';
                                const highlightColor = genre === 'HP' ? '#10b981' :
                                                     genre === 'SEO' ? '#f59e0b' :
                                                     genre === 'AD' ? '#8b5cf6' : '#6b7280';
                                const genreIcon = genre === 'HP' ? 'ğŸ ' :
                                                genre === 'SEO' ? 'ğŸ”' :
                                                genre === 'AD' ? 'ğŸ“º' : 'ğŸ“';

                                return `
                                    <div style="margin-bottom: 10px; padding: 12px; background: white; border-radius: 6px; border-left: 4px solid ${highlightColor};">
                                        <div style="font-weight: 600; color: #374151; margin-bottom: 5px;">
                                            ${genreIcon} å¤‰æ›´ç®‡æ‰€ ${index + 1}
                                        </div>
                                        <div style="color: #6b7280; font-size: 14px;">${escapeHtml(highlight.description)}</div>
                                        <div style="color: #9ca3af; font-size: 12px; margin-top: 5px;">
                                            åº§æ¨™: x=${highlight.coords.x}, y=${highlight.coords.y}, å¹…=${highlight.coords.width}, é«˜ã•=${highlight.coords.height}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                ` : ''}

                <!-- ãƒ†ã‚­ã‚¹ãƒˆæ¯”è¼ƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div>
                    <h3 style="margin-bottom: 15px; color: #1e293b; font-weight: 600;">ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›´æ¯”è¼ƒ</h3>
                    <div class="comparison-view">
                        <div class="comparison-card previous">
                            <div class="comparison-header previous">å¤‰æ›´å‰ã®ãƒ†ã‚­ã‚¹ãƒˆ</div>
                            <div class="comparison-content">
                                <div class="comparison-item">
                                    <div class="comparison-label">ã‚¿ã‚¤ãƒˆãƒ«</div>
                                    <div class="comparison-text">${escapeHtml(selectedCompany.previous_title || 'ãƒ‡ãƒ¼ã‚¿ãªã—')}</div>
                                </div>
                                <div class="comparison-item">
                                    <div class="comparison-label">èª¬æ˜æ–‡</div>
                                    <div class="comparison-text">${escapeHtml(selectedCompany.previous_description || 'ãƒ‡ãƒ¼ã‚¿ãªã—')}</div>
                                </div>
                                <div class="comparison-item">
                                    <div class="comparison-label">ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</div>
                                    <div class="comparison-text">${escapeHtml(selectedCompany.previous_content || 'ãƒ‡ãƒ¼ã‚¿ãªã—')}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="comparison-card current">
                            <div class="comparison-header current">å¤‰æ›´å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆ</div>
                            <div class="comparison-content">
                                <div class="comparison-item">
                                    <div class="comparison-label">ã‚¿ã‚¤ãƒˆãƒ«</div>
                                    <div class="comparison-text">${escapeHtml(selectedCompany.current_title || 'ãƒ‡ãƒ¼ã‚¿ãªã—')}</div>
                                </div>
                                <div class="comparison-item">
                                    <div class="comparison-label">èª¬æ˜æ–‡</div>
                                    <div class="comparison-text">${escapeHtml(selectedCompany.current_description || 'ãƒ‡ãƒ¼ã‚¿ãªã—')}</div>
                                </div>
                                <div class="comparison-item">
                                    <div class="comparison-label">ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</div>
                                    <div class="comparison-text">${escapeHtml(selectedCompany.current_content || 'ãƒ‡ãƒ¼ã‚¿ãªã—')}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- è©³ç´°ãªå¤‰æ›´å±¥æ­´ -->
                ${selectedCompany.changes && selectedCompany.changes.length > 0 ? `
                    <div style="margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; border: 1px solid #bfdbfe;">
                        <h4 style="margin-bottom: 15px; color: #1e40af; font-weight: 600;">ğŸ“‹ å¤‰æ›´è©³ç´°</h4>
                        ${selectedCompany.changes.map((change, changeIndex) => {
                            const borderColor = change.type === 'HP' ? '#10b981' :
                                              change.type === 'SEO' ? '#f59e0b' :
                                              change.type === 'AD' ? '#8b5cf6' : '#6b7280';
                            const icon = change.type === 'HP' ? 'ğŸ ' :
                                       change.type === 'SEO' ? 'ğŸ”' :
                                       change.type === 'AD' ? 'ğŸ“º' : 'ğŸ“';

                            return `
                                <div style="margin-bottom: 15px; background: white; border-radius: 6px; border-left: 4px solid ${borderColor}; overflow: hidden;">
                                    <div style="padding: 15px; cursor: pointer; background: #fafafa;" onclick="toggleDetail(${changeIndex})">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <div style="font-weight: 600; color: #374151; margin-bottom: 5px;">
                                                    ${icon} ${change.category} (${change.date})
                                                </div>
                                                <div style="color: #6b7280; font-size: 14px;">${escapeHtml(change.description)}</div>
                                            </div>
                                            <div id="toggle-icon-${changeIndex}" style="font-size: 20px; color: #64748b;">â–¼</div>
                                        </div>
                                    </div>

                                    ${change.detailedAnalysis ? `
                                        <div id="detail-${changeIndex}" style="display: none; padding: 15px; border-top: 1px solid #e2e8f0;">
                                            <div style="background: #fffbeb; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 3px solid #f59e0b;">
                                                <div style="font-weight: 700; color: #92400e; margin-bottom: 10px; font-size: 15px;">ğŸ¯ å¤‰æ›´ã‚¿ã‚¤ãƒ—</div>
                                                <div style="color: #78350f; font-size: 14px;">${escapeHtml(change.detailedAnalysis.changeType)}</div>
                                            </div>

                                            <div style="background: #f0fdf4; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 3px solid #10b981;">
                                                <div style="font-weight: 700; color: #166534; margin-bottom: 10px; font-size: 15px;">ğŸ“ å…·ä½“çš„ãªå¤‰æ›´å†…å®¹</div>
                                                <ul style="margin: 0; padding-left: 20px; color: #14532d;">
                                                    ${change.detailedAnalysis.whatChanged.map(item =>
                                                        `<li style="margin-bottom: 6px; font-size: 13px;">${escapeHtml(item)}</li>`
                                                    ).join('')}
                                                </ul>
                                            </div>

                                            ${change.detailedAnalysis.seoStrategy ? `
                                                <div style="background: #fef3c7; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 3px solid #f59e0b;">
                                                    <div style="font-weight: 700; color: #92400e; margin-bottom: 10px; font-size: 15px;">ğŸ” SEOæˆ¦ç•¥è©³ç´°</div>

                                                    <div style="margin-bottom: 12px;">
                                                        <div style="font-weight: 600; color: #78350f; margin-bottom: 5px; font-size: 13px;">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</div>
                                                        <ul style="margin: 0; padding-left: 20px; color: #78350f;">
                                                            ${change.detailedAnalysis.seoStrategy.targetKeywords.map(kw =>
                                                                `<li style="margin-bottom: 4px; font-size: 12px;">${escapeHtml(kw)}</li>`
                                                            ).join('')}
                                                        </ul>
                                                    </div>

                                                    <div style="margin-bottom: 12px;">
                                                        <div style="font-weight: 600; color: #78350f; margin-bottom: 5px; font-size: 13px;">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é…ç½®æˆ¦ç•¥</div>
                                                        <div style="font-size: 12px; color: #78350f; line-height: 1.6;">
                                                            â€¢ Title: ${escapeHtml(change.detailedAnalysis.seoStrategy.keywordPlacement.titleTag)}<br>
                                                            â€¢ Meta Description: ${escapeHtml(change.detailedAnalysis.seoStrategy.keywordPlacement.metaDescription)}<br>
                                                            â€¢ H1: ${escapeHtml(change.detailedAnalysis.seoStrategy.keywordPlacement.h1Tag)}<br>
                                                            â€¢ Body: ${escapeHtml(change.detailedAnalysis.seoStrategy.keywordPlacement.bodyContent)}
                                                        </div>
                                                    </div>

                                                    <div style="background: white; padding: 10px; border-radius: 4px;">
                                                        <div style="font-weight: 600; color: #92400e; margin-bottom: 5px; font-size: 13px;">æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ</div>
                                                        <div style="font-size: 12px; color: #78350f;">${escapeHtml(change.detailedAnalysis.seoStrategy.expectedImpact)}</div>
                                                    </div>

                                                    ${change.detailedAnalysis.technicalDetails ? `
                                                        <div style="margin-top: 10px; background: white; padding: 10px; border-radius: 4px;">
                                                            <div style="font-weight: 600; color: #92400e; margin-bottom: 5px; font-size: 13px;">æŠ€è¡“çš„æ–½ç­–</div>
                                                            <div style="font-size: 12px; color: #78350f; line-height: 1.6;">
                                                                â€¢ æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿: ${escapeHtml(change.detailedAnalysis.technicalDetails.structuredData)}<br>
                                                                â€¢ ãƒšãƒ¼ã‚¸é€Ÿåº¦: ${escapeHtml(change.detailedAnalysis.technicalDetails.pageSpeed)}<br>
                                                                â€¢ ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–: ${escapeHtml(change.detailedAnalysis.technicalDetails.mobileOptimization)}
                                                            </div>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            ` : ''}

                                            ${change.detailedAnalysis.adPlatforms ? `
                                                <div style="background: #f5f3ff; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 3px solid #8b5cf6;">
                                                    <div style="font-weight: 700; color: #5b21b6; margin-bottom: 10px; font-size: 15px;">ğŸ“º åºƒå‘Šãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥æˆ¦ç•¥</div>

                                                    ${change.detailedAnalysis.adPlatforms.googleSearch ? `
                                                        <div style="background: white; padding: 12px; border-radius: 4px; margin-bottom: 10px;">
                                                            <div style="font-weight: 600; color: #5b21b6; margin-bottom: 8px; font-size: 13px;">ğŸ” Googleæ¤œç´¢åºƒå‘Š</div>
                                                            <div style="font-size: 12px; color: #6b21a8; line-height: 1.6;">
                                                                â€¢ äºˆç®—: ${escapeHtml(change.detailedAnalysis.adPlatforms.googleSearch.budget)}<br>
                                                                â€¢ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆKW: ${change.detailedAnalysis.adPlatforms.googleSearch.targetKeywords.join(', ')}<br>
                                                                â€¢ åºƒå‘Šæ–‡: ${escapeHtml(change.detailedAnalysis.adPlatforms.googleSearch.adCopy)}<br>
                                                                â€¢ CTRç›®æ¨™: ${escapeHtml(change.detailedAnalysis.adPlatforms.googleSearch.ctr)}
                                                            </div>
                                                        </div>
                                                    ` : ''}

                                                    ${change.detailedAnalysis.adPlatforms.googleDisplay ? `
                                                        <div style="background: white; padding: 12px; border-radius: 4px; margin-bottom: 10px;">
                                                            <div style="font-weight: 600; color: #5b21b6; margin-bottom: 8px; font-size: 13px;">ğŸ¨ Googleãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤åºƒå‘Š</div>
                                                            <div style="font-size: 12px; color: #6b21a8; line-height: 1.6;">
                                                                â€¢ äºˆç®—: ${escapeHtml(change.detailedAnalysis.adPlatforms.googleDisplay.budget)}<br>
                                                                â€¢ ã‚¿ãƒ¼ã‚²ãƒ†ã‚£ãƒ³ã‚°: ${escapeHtml(change.detailedAnalysis.adPlatforms.googleDisplay.targeting)}<br>
                                                                â€¢ ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–: ${escapeHtml(change.detailedAnalysis.adPlatforms.googleDisplay.creative)}
                                                            </div>
                                                        </div>
                                                    ` : ''}

                                                    ${change.detailedAnalysis.adPlatforms.youtube ? `
                                                        <div style="background: white; padding: 12px; border-radius: 4px;">
                                                            <div style="font-weight: 600; color: #5b21b6; margin-bottom: 8px; font-size: 13px;">â–¶ï¸ YouTubeåºƒå‘Š</div>
                                                            <div style="font-size: 12px; color: #6b21a8; line-height: 1.6;">
                                                                â€¢ äºˆç®—: ${escapeHtml(change.detailedAnalysis.adPlatforms.youtube.budget)}<br>
                                                                â€¢ å‹•ç”»å°º: ${escapeHtml(change.detailedAnalysis.adPlatforms.youtube.videoLength)}<br>
                                                                â€¢ è¨´æ±‚å†…å®¹: ${escapeHtml(change.detailedAnalysis.adPlatforms.youtube.message)}
                                                            </div>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            ` : ''}

                                            <div style="background: #ecfdf5; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 3px solid #10b981;">
                                                <div style="font-weight: 700; color: #047857; margin-bottom: 10px; font-size: 15px;">ğŸ’¼ ãƒ“ã‚¸ãƒã‚¹ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ</div>
                                                <div style="color: #065f46; font-size: 13px; line-height: 1.7;">${escapeHtml(change.detailedAnalysis.businessImpact)}</div>
                                            </div>

                                            ${change.detailedAnalysis.targetAudience ? `
                                                <div style="background: #eff6ff; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 3px solid #3b82f6;">
                                                    <div style="font-weight: 700; color: #1e40af; margin-bottom: 10px; font-size: 15px;">ğŸ¯ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤</div>
                                                    <div style="color: #1e3a8a; font-size: 13px;">${escapeHtml(change.detailedAnalysis.targetAudience)}</div>
                                                </div>
                                            ` : ''}

                                            <div style="background: #fef2f2; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 3px solid #ef4444;">
                                                <div style="font-weight: 700; color: #dc2626; margin-bottom: 10px; font-size: 15px;">âš”ï¸ ç«¶åˆçŠ¶æ³åˆ†æ</div>
                                                <div style="color: #991b1b; font-size: 13px; line-height: 1.7;">${escapeHtml(change.detailedAnalysis.competitiveContext)}</div>
                                            </div>

                                            ${change.detailedAnalysis.estimatedBudget ? `
                                                <div style="background: #faf5ff; padding: 15px; border-radius: 6px; border-left: 3px solid #a855f7;">
                                                    <div style="font-weight: 700; color: #7e22ce; margin-bottom: 10px; font-size: 15px;">ğŸ’° æ¨å®šæŠ•è³‡é¡</div>
                                                    <div style="color: #6b21a8; font-size: 13px;">${escapeHtml(change.detailedAnalysis.estimatedBudget)}</div>
                                                </div>
                                            ` : ''}

                                            ${change.detailedAnalysis.roi ? `
                                                <div style="background: #faf5ff; padding: 15px; border-radius: 6px; margin-top: 10px; border-left: 3px solid #a855f7;">
                                                    <div style="font-weight: 700; color: #7e22ce; margin-bottom: 10px; font-size: 15px;">ğŸ“Š ROIç›®æ¨™</div>
                                                    <div style="color: #6b21a8; font-size: 13px;">${escapeHtml(change.detailedAnalysis.roi)}</div>
                                                </div>
                                            ` : ''}

                                            ${change.detailedAnalysis.metrics ? `
                                                <div style="background: #f0fdfa; padding: 15px; border-radius: 6px; margin-top: 10px; border-left: 3px solid #14b8a6;">
                                                    <div style="font-weight: 700; color: #0f766e; margin-bottom: 10px; font-size: 15px;">ğŸ“ˆ å®šé‡æŒ‡æ¨™</div>
                                                    <div style="font-size: 12px; color: #115e59; line-height: 1.6;">
                                                        ${Object.entries(change.detailedAnalysis.metrics).map(([key, value]) =>
                                                            `â€¢ ${key}: ${escapeHtml(value)}`
                                                        ).join('<br>')}
                                                    </div>
                                                </div>
                                            ` : ''}

                                            ${change.detailedAnalysis.testingStrategy ? `
                                                <div style="background: #fff7ed; padding: 15px; border-radius: 6px; margin-top: 10px; border-left: 3px solid #f97316;">
                                                    <div style="font-weight: 700; color: #c2410c; margin-bottom: 10px; font-size: 15px;">ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥</div>
                                                    <div style="color: #9a3412; font-size: 13px;">${escapeHtml(change.detailedAnalysis.testingStrategy)}</div>
                                                </div>
                                            ` : ''}
                                        </div>
                                    ` : `
                                        <div style="padding: 20px; background: #f8fafc; border-radius: 6px; text-align: center;">
                                            <div style="font-size: 40px; margin-bottom: 10px;">ğŸ“Š</div>
                                            <div style="font-weight: 600; color: #475569; margin-bottom: 10px; font-size: 14px;">è©³ç´°åˆ†æãƒ‡ãƒ¼ã‚¿åé›†ä¸­</div>
                                            <div style="color: #64748b; font-size: 12px; line-height: 1.6; max-width: 500px; margin: 0 auto;">
                                                ã“ã®ä¼æ¥­ã®è©³ç´°ãªãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥åˆ†æã¯ç¾åœ¨åé›†ä¸­ã§ã™ã€‚<br>
                                                å¤‰æ›´æ¤œçŸ¥å¾Œã€å°‚é–€ã‚¢ãƒŠãƒªã‚¹ãƒˆã«ã‚ˆã‚‹è©³ç´°åˆ†æã‚’é †æ¬¡è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚<br>
                                                <span style="color: #3b82f6; font-weight: 600;">è¿‘æ—¥å…¬é–‹äºˆå®š</span>
                                            </div>
                                        </div>
                                    `
                                    }
                                </div>
                            `;
                        }).join('')}
                    </div>
                ` : ''}
            `;
            
            section.style.display = 'block';
        }

        // æ¯”è¼ƒè¡¨ç¤ºã‚’éš ã™
        function hideComparison() {
            document.getElementById('comparisonSection').style.display = 'none';
        }

        // å¤‰æ›´å±¥æ­´æç”»
        function renderChanges() {
            const container = document.getElementById('changesContainer');
            
            // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            let filteredChanges = changes;
            if (selectedCompany) {
                filteredChanges = changes.filter(change => change.company_id === selectedCompany.id);
            }
            
            if (filteredChanges.length === 0) {
                const message = selectedCompany 
                    ? `${selectedCompany.name}ã®å¤‰æ›´å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“`
                    : 'å¤‰æ›´å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“';
                container.innerHTML = `<div class="empty-state">${message}<br><small>å®šæœŸç›£è¦–ã§ãƒ‡ãƒ¼ã‚¿ãŒè“„ç©ã•ã‚Œã¾ã™</small></div>`;
                return;
            }
            
            container.innerHTML = `
                <div class="changes-list">
                    ${filteredChanges.slice(0, 20).map(change => `
                        <div class="change-item">
                            <div class="change-header">
                                ${escapeHtml(change.company_name)} - ${getChangeTypeLabel(change.change_type)}
                            </div>
                            <div class="change-details">
                                <div class="change-before">
                                    <div class="change-label">å¤‰æ›´å‰</div>
                                    <div class="change-text">${truncateText(change.old_value, 150)}</div>
                                </div>
                                <div class="change-after">
                                    <div class="change-label">å¤‰æ›´å¾Œ</div>
                                    <div class="change-text">${truncateText(change.new_value, 150)}</div>
                                </div>
                            </div>
                            <div class="change-date">${formatDateTime(change.detected_at)}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function truncateText(text, maxLength) {
            if (!text) return '-';
            text = escapeHtml(text);
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        }

        function formatDateTime(dateString) {
            if (!dateString) return 'ä¸æ˜';
            try {
                return new Date(dateString).toLocaleString('ja-JP');
            } catch {
                return dateString;
            }
        }

        function getChangeTypeLabel(type) {
            const labels = {
                'title_change': 'ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´',
                'description_change': 'ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å¤‰æ›´',
                'content_change': 'ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¤‰æ›´'
            };
            return labels[type] || type;
        }

        function showError(message) {
            const container = document.getElementById('errorContainer');
            container.innerHTML = `<div class="error-message">${escapeHtml(message)}</div>`;
        }

        function clearError() {
            document.getElementById('errorContainer').innerHTML = '';
        }

        // è©³ç´°åˆ†æã®å±•é–‹ãƒ»æŠ˜ã‚ŠãŸãŸã¿
        function toggleDetail(index) {
            const detailEl = document.getElementById(`detail-${index}`);
            const iconEl = document.getElementById(`toggle-icon-${index}`);

            if (detailEl.style.display === 'none') {
                detailEl.style.display = 'block';
                iconEl.textContent = 'â–²';
            } else {
                detailEl.style.display = 'none';
                iconEl.textContent = 'â–¼';
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>